{"version":3,"sources":["../../src/middleware/requireAuth.js"],"names":["req","res","next","authHeader","get","HttpError","code","message","token","replace","User","findByToken","then","user","e"],"mappings":";;;;;;;AAAA;;AACA;;;;eAEe,kBAACA,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACjC,MAAMC,UAAU,GAAGH,GAAG,CAACI,GAAJ,CAAQ,eAAR,CAAnB;;AACA,MAAG,CAACD,UAAJ,EAAgB;AACd,WAAOD,IAAI,CAAC,IAAIG,gBAAJ,CAAc;AAAEC,MAAAA,IAAI,EAAE,GAAR;AAAaC,MAAAA,OAAO,EAAE;AAAtB,KAAd,CAAD,CAAX;AACD;;AAED,MAAMC,KAAK,GAAGL,UAAU,CAACM,OAAX,CAAmB,UAAnB,EAA+B,EAA/B,CAAd;;AACA,MAAG,CAACD,KAAJ,EAAW;AACT,WAAON,IAAI,CAAC,IAAIG,gBAAJ,CAAc;AAAEC,MAAAA,IAAI,EAAE,GAAR;AAAaC,MAAAA,OAAO,EAAE;AAAtB,KAAd,CAAD,CAAX;AACD;;AAED,MAAI;AACFG,mBAAKC,WAAL,CAAiBH,KAAjB,EACGI,IADH,CACQ,UAAAC,IAAI,EAAI;AACZb,MAAAA,GAAG,CAACa,IAAJ,GAAWA,IAAX;AACAX,MAAAA,IAAI;AACL,KAJH;AAKD,GAND,CAOA,OAAOY,CAAP,EAAU;AACR,WAAOZ,IAAI,CAAC,IAAIG,gBAAJ,CAAc;AAAEC,MAAAA,IAAI,EAAE,GAAR;AAAaC,MAAAA,OAAO,EAAE;AAAtB,KAAd,CAAD,CAAX;AACD;AAEF,C","sourcesContent":["import User from '../resources/users/model';\nimport { HttpError } from './error';\n\nexport default (req, res, next) => {\n  const authHeader = req.get('Authorization');\n  if(!authHeader) {\n    return next(new HttpError({ code: 401, message: 'Missing token' }))\n  }\n\n  const token = authHeader.replace(/bearer /i, '');\n  if(!token) {\n    return next(new HttpError({ code: 401, message: 'Invalid blank token' }))\n  }\n\n  try {\n    User.findByToken(token)\n      .then(user => {\n        req.user = user;\n        next();\n      });\n  }\n  catch (e) {\n    return next(new HttpError({ code: 401, message: 'Invalid token' }))\n  }\n\n}\n"],"file":"requireAuth.js"}